<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>到位 - 服务商</title>
        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
        <meta name="viewport"
              content="user-scalable=no,
                       width=device-width,
                       initial-scale=1.0,
                       minimum-scale=1.0,
                       maximum-scale=1.0"/>
        <link rel="stylesheet" href="http://at.alicdn.com/t/font_637318_oata4op9so9wwmi.css">
        <link rel="stylesheet" href="http://127.0.0.1:3000/stylus/reset.css">
        <link rel="stylesheet" href="http://127.0.0.1:3000/stylus/detail.css">
    </head>
    
    <body>
        <!-- 模拟屏幕区域 -->
        <div id="wrap">
            <!-- 头部 -->
            <header>
                <div class="top_line1_box">
                    <div class="top_line1">
                        <div class="line1_left">
                            <img src="http://127.0.0.1:3000/img/citypoint.png" alt="定位">
                            <span class="cur_city">北京</span>
                            <span class="switch_city">[切换城市]</span>
                        </div>
                        <ul class="line1_right clearfix">
                            <li><a href="http://127.0.0.1:3000">首页</a></li>
                            <li><a href="javascript:">关于我们</a></li>
                            <li class="active"><a href="javascript:">服务商</a></li>
                            <li><a href="javascript:">商家入驻</a></li>
                            <li><a href="javascript:">商家登录</a></li>
                            <li><a href="javascript:">到位APP</a></li>
                        </ul>
                    </div>
                </div>
                
                <!--<div class="top_line2">-->
                    <!--<div class="line2_left">-->
                        <!--<div class="daowei_logo">-->
                            <!--<img src="http://127.0.0.1:3000/img/a.jpg" alt="到位">-->
                            <!--<div>高品质上门服务平台</div>-->
                        <!--</div>-->
                        <!--<form class="daowei_word" action="javascript:" method="get">-->
                            <!--<label>-->
                                <!--<img src="http://127.0.0.1:3000/img/a.jpg" alt="搜索">-->
                                <!--<input type="text"/>-->
                            <!--</label>-->
                            <!--<button type="button">搜服务</button>-->
                        <!--</form>-->
                    <!--</div>-->
                    <!---->
                    <!--<div class="line2_right">-->
                        <!--<img src="http://127.0.0.1:3000/img/a.jpg" alt="二维码">-->
                    <!--</div>-->
                <!--</div>-->
            </header>
            
            <div id="content">
                <!-- 服务标题 -->
                <section class="service_title_wrapper clearfix">
                    <div id="service_title" class="service_title_box">
                        <!--<div class="left_info">-->
                            <!--<span class="service_title">云家政</span>-->
                            <!--<span class="work_time">营业时间:-->
                                <!--<span>09:00-18:00</span>-->
                            <!--</span>-->
                            <!--<span class="phone_time">最近可预约时间:-->
                                <!--<span>04月21日 15:30</span>-->
                            <!--</span>-->
                        <!--</div>-->
                        <!--<ul class="right_info">-->
                           <!--<li>-->
                               <!--<p class="ok_order">45341</p>-->
                               <!--<p>成功接单</p>-->
                           <!--</li>-->
                           <!--<li>|</li>-->
                           <!--<li>-->
                               <!--<p class="order_percent">92%</p>-->
                               <!--<p>接单率</p>-->
                           <!--</li>-->
                           <!--<li>|</li>-->
                           <!--<li>-->
                               <!--<p class="nice_percent">86%</p>-->
                               <!--<p>好评率</p>-->
                           <!--</li>-->
                        <!--</ul>-->
                    </div>
                </section>
                
                <!-- 服务导航 -->
                <section class="service_nav_wrapper clearfix">
                    <ul class="service_nav_box">
                        <li class="active"><a href="javascript:">服务项目</a></li>
                        <li><a href="javascript:">商家简介</a></li>
                        <li><a href="javascript:">用户评论</a></li>
                    </ul>
                </section>
                
                <!-- 服务项目 -->
                <section class="service_project_wrapper clearfix">
                    <div class="service_project_box">
                        <div class="service_project">
                            <div class="service_ad">
                                <div class="ad_box1">
                                    <img class="ad_img1" src="http://127.0.0.1:3000/img/daowayApp.png" alt="广告">
                                </div>
                                <div class="ad_box2">
                                    <img class="ad_img2" src="http://127.0.0.1:3000/img/daowayApp.png" alt="广告">
                                </div>
                            </div>
                            <p class="project_title"><span>服务项目</span></p>
                            <a id="service_project" class="project_content" href="javascript:">
                                <!--<img src="http://127.0.0.1:3000/img/daowayApp.png" alt="service">-->
                                <!--<div>-->
                                    <!--<p class="line1_title">家庭保洁</p>-->
                                    <!--<p class="line2_des ellipsis">家庭保洁服务，2小时起订。服务时间未使用完不做退款处理。阿...</p>-->
                                    <!--<div class="line3_info clearfix">-->
                                        <!--<div class="left_price">-->
                                            <!--<span class="project_price">-->
                                                <!--<span class="new_price">35</span>元每小时-->
                                            <!--</span>-->
                                            <!--<span>-->
                                                <!--原价<span class="old_price">45</span>-->
                                            <!--</span>-->
                                        <!--</div>-->
                                        <!--<div class="right_count">已售59700</div>-->
                                    <!--</div>-->
                                <!--</div>-->
                            </a>
                        </div>
                    </div>
                </section>
                
                <!-- 商家简介 -->
                <section class="service_des_wrapper clearfix">
                    <div class="service_des_box">
                        <div class="service_des">
                            <!--<p class="service_des_title"><span>商家简介</span></p>-->
                            <!--<p class="service_name">上海家谐网络科技有限公司 <img src="http://localhost:3000/img/renzheng.jpg" alt="已认证"/></p>-->
                            <!--<p class="service_des_content">-->
                                <!--云家政是家政服务在线预订平台。我们的目标是让每个家庭都能获得诚信、便捷、有保障的家政服务。云家政拥有国内最大的实名认证家庭服务员数据库，目前平台上有超过100000名专业服务人员；数百个家政服务商，遍布全国主要城市各个社区。 云家政倡导简单、轻松的生活方式。通过把分散的家政服务能力汇集和分配，让中国家庭获得诚信、便捷、有保障的家政服务，解决日常生活中的麻烦事，把更多时间留给自己和家人，提高生活品质。-->
                            <!--</p>-->
                        </div>
                    </div>
                </section>
                
                <!-- 用户评论 -->
                <section class="user_comment_wrapper clearfix">
                    <div class="user_comment_box">
                        <div class="user_comment">
                            <p class="user_comment_title"><span>用户评论</span></p>
                            <ul class="user_comment_info">
                                <!--<li class="clearfix">-->
                                    <!--<div class="left_avatar"><img src="http://localhost:3000/img/fuwushangimg.png" alt="avatar"></div>-->
                                    <!--<div class="right_content">-->
                                        <!--<p class="user_name">耶梦加德</p>-->
                                        <!--<p class="user_score">-->
                                            <!--<img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">-->
                                            <!--<img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">-->
                                            <!--<img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">-->
                                            <!--<img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">-->
                                            <!--<img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">-->
                                            <!--<span>15621321354</span>-->
                                        <!--</p>-->
                                        <!--<p class="user_words">阿姨服务非常好，收拾的很干净。</p>-->
                                        <!--<p class="user_pos">-->
                                            <!--<img src="http://localhost:3000/img/position.jpg" alt="position"/>-->
                                            <!--上海-->
                                            <!--普陀区-->
                                        <!--</p>-->
                                    <!--</div>-->
                                <!--</li>-->
                            </ul>
                            <div class="my_pager unSelectedAble">
                                <div class="prev_page">上一页</div>
                                <div class="next_page active">下一页</div>
                                <ul id="pager" class="clearfix">
                                    <li class="active"><a href="javascript:">1</a></li>
                                    <li><a href="javascript:">2</a></li>
                                    <li><a href="javascript:">3</a></li>
                                    <li><a href="javascript:">4</a></li>
                                    <li><a href="javascript:">5</a></li>
                                    <li><a href="javascript:">6</a></li>
                                    <li><a href="javascript:">7</a></li>
                                    <li><a href="javascript:">8</a></li>
                                    <li><a href="javascript:">9</a></li>
                                    <li><a href="javascript:">...</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
            
                <!----------------------------- 静态的底部 ------------------------------->
                <section class="service_pos_box">
                    <div class="service_pos">
                        <div class="we_promise">
                            <h2>
                                到位<span>服务</span>保障
                            </h2>
                            <p>到位平台担保交易安全，交易未成功100%退款</p>
                        </div>
    
                        <div class="service_promise">
                            <ul class="clearfix">
                                <li>
                                    <img src="http://127.0.0.1:3000/img/anquan.jpg" width="20" height="20" alt="service">
                                    <span>优选服务</span>
                                </li>
                                <li>
                                    <img src="http://127.0.0.1:3000/img/anquan.jpg" width="20" height="20" alt="service">
                                    <span>全程保障</span>
                                </li>
                                <li>
                                    <img src="http://127.0.0.1:3000/img/anquan.jpg" width="20" height="20" alt="service">
                                    <span>安全无忧</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>
                
                <footer class="footer_box">
                    <div class="footer">
                        <p class="company">合作伙伴</p>
                        <ul class="company_ul clearfix">
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/lairen.jpg" alt="company"></li>
                            <li><img src="http://127.0.0.1:3000/img/guanjia.jpg" alt="company"></li>
                        </ul>
                        <p class="copyright">
                            ©2015 版权所有 到位 daoway.com 京ICP备15001471号-1 北京邻家科技有限公司
                        </p>
                    </div>
                </footer>
                <!------------------------------------------------------------------------>
            </div>
        </div>
    
        
        
        
    
        <script id="service_title_template" type="text/html">
            {{ each data }}
                <div class="left_info">
                    <span class="service_title">{{$value.name}}</span>
                    <span class="work_time">营业时间:
                        <span>{{$value.seredate}}</span>
                    </span>
                    <span class="phone_time">最近可预约时间:
                        <span>{{$value.servedatalately}}</span>
                    </span>
                </div>
                <ul class="right_info">
                    <li>
                        <p class="ok_order">{{$value.orderCount}}</p>
                        <p>成功接单</p>
                    </li>
                    <li>|</li>
                    <li>
                        <p class="order_percent">{{$value.accept}}</p>
                        <p>接单率</p>
                    </li>
                    <li>|</li>
                    <li>
                        <p class="nice_percent">{{$value.praise}}</p>
                        <p>好评率</p>
                    </li>
                </ul>
            {{ /each }}
        </script>
    
        <script id="service_project_template" type="text/html">
            {{ each data }}
                <img src="{{$value.imgUrl}}" alt="service">
                <div>
                    <p class="line1_title">{{$value.title}}</p>
                    <p class="line2_des ellipsis">{{$value.servedes}}</p>
                    <div class="line3_info clearfix">
                        <div class="left_price">
                            <span class="project_price">
                                <span class="new_price">{{$value.price}}</span>元每小时
                            </span>
                            <span>
                                原价<span class="old_price">{{$value.oldPrice}}</span>
                            </span>
                        </div>
                        <div class="right_count">已售{{$value.soldCount}}</div>
                    </div>
                </div>
            {{ /each }}
        </script>
    
        <script id="service_des_template" type="text/html">
            {{ each data }}
                <p class="service_des_title"><span>商家简介</span></p>
                <p class="service_name">
                    上海家谐网络科技有限公司
                    <img src="http://localhost:3000/img/renzheng.jpg" alt="已认证"/></p>
                <p class="service_des_content">
                    {{$value.business}}
                </p>
            {{ /each }}
        </script>
    
        <script id="user_comment_template" type="text/html">
            {{ each data }}
                <li class="clearfix">
                    <div class="left_avatar">
                        <img src="{{$value.iconUrl}}" alt="avatar">
                    </div>
                    <div class="right_content">
                        <p class="user_name">{{$value.nick}}</p>
                        <p class="user_score">
                            <% for(var i=0; i < $value.star; i++ ){ %>
                                <img src="http://localhost:3000/img/red_star.png" width="10px" height="auto" alt="star">
                            <% } %>
                            <span><%= $imports.dateFormat($value.createtime, 'yyyy-MM-dd hh:mm') %></span>
                        </p>
                        <p class="user_words">{{$value.comment}}</p>
                        <p class="user_pos">
                            <img src="http://localhost:3000/img/position.jpg" alt="position"/>
                            {{$value.city}}
                            {{$value.area}}
                        </p>
                    </div>
                </li>
            {{ /each }}
        </script>
        
        <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
        <script type="text/javascript" src="http://127.0.0.1:3000/js/template-web.js"></script>
        <script type="text/javascript">
            /**** 头部 fixed ****/
            $(document).on("scroll", function (e) {
                if($("#content")[0].getBoundingClientRect().top<0){
                    $(".top_line1_box").addClass("fixed_header");
                }else{
                    $(".top_line1_box").removeClass("fixed_header");
                }
            });
            /**
             * 对日期进行格式化，
             * @param date 要格式化的日期
             * @param format 进行格式化的模式字符串
             *     支持的模式字母有：
             *     y:年,
             *     M:年中的月份(1-12),
             *     d:月份中的天(1-31),
             *     h:小时(0-23),
             *     m:分(0-59),
             *     s:秒(0-59),
             *     S:毫秒(0-999),
             *     q:季度(1-4)
             * @return String
             * @author yanis.wang
             * @see http://yaniswang.com/frontend/2013/02/16/dateformat-performance/
             */
            function dateFormat(date, format) {
                date = new Date(date);
                var map = {
                    "M": date.getMonth() + 1, //月份
                    "d": date.getDate(), //日
                    "h": date.getHours(), //小时
                    "m": date.getMinutes(), //分
                    "s": date.getSeconds(), //秒
                    "q": Math.floor((date.getMonth() + 3) / 3), //季度
                    "S": date.getMilliseconds() //毫秒
                };
                format = format.replace(/([yMdhmsqS])+/g, function(all, t){
                    var v = map[t];
                    if(v !== undefined){
                        if(all.length > 1){
                            v = '0' + v;
                            v = v.substr(v.length-2);
                        }
                        return v;
                    }
                    else if(t === 'y'){
                        return (date.getFullYear() + '').substr(4 - all.length);
                    }
                    return all;
                });
                return format;
            };
            function activeClass($obj, index, classStr="active"){
                for (let i = 0; i < $obj.length; i++) {
                    $($obj[i]).removeClass(classStr)
                }
                $($obj[index]).addClass(classStr)
            }
            function isBtnOk(){
                curPageIndex === 0?$prevBtn.removeClass("active"):$prevBtn.addClass("active");
                curPageIndex === pageMaxIndex?$nextBtn.removeClass("active"):$nextBtn.addClass("active");
            }
            template.defaults.imports.dateFormat = dateFormat;
            
            /**** 分页器 ****/
            $prevBtn = $(".my_pager>.prev_page");
            $nextBtn = $(".my_pager>.next_page");
            
            let curPageIndex = 0;
            let pageMaxIndex = -1;
            function getPageComment(pageIndex){
                $.get("http://127.0.0.1:3000/user_comment",{pageIndex}, function(response){
                    if(response.code === "200"){
                        $(".user_comment .user_comment_info").html(template(
                            "user_comment_template",
                            {data: response.data}
                        ));
                    }
                });
            }
            $("#pager").on("click", "li", function(){
                if($(this).index() === curPageIndex){
                    return 0;    // 避免重复发不必要的请求
                }
                curPageIndex = $(this).index();
                getPageComment(curPageIndex);
                isBtnOk();
                activeClass($("#pager>li"), curPageIndex);
            });
            $prevBtn.on("click", function(){
                if(curPageIndex === 0){
                    // 失能 上一页 $prevBtn
                    return 0;
                }
                getPageComment(--curPageIndex);
                isBtnOk();
                activeClass($("#pager>li"), curPageIndex);
            });
            $nextBtn.on("click", function(){
                if(curPageIndex === pageMaxIndex){
                    // 失能 下一页 $nextBtn
                    return 0;
                }
                getPageComment(++curPageIndex);
                isBtnOk();
                activeClass($("#pager>li"), curPageIndex);
            });
            
            /**** ajax 获取 json 数据 ****/
            $.get("http://127.0.0.1:3000/service_detail", function(response){
                if(response.code === "200"){
                    pageMaxIndex = response.data[0].commentCount/10-1;
                    $("#service_title").html(template(
                        "service_title_template",
                        {data: response.data}
                    ));
                    $("#service_project").html(template(
                        "service_project_template",
                        {data: response.data}
                    ));
                    $(".service_des_box .service_des").html(template(
                        "service_des_template",
                        {data: response.data}
                    ));
                }
            });
            getPageComment(0)
        </script>
    </body>
</html>
